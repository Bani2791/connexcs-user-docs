# Rate Card Building

It is good practice to base your rate cards around provider cards rather than to just make your own up, this is for many reasons. One of which is code accuracy. 

## Rate Card Compilation Engine

ConnexCS features a very comprehensive rate card building engine. It can ingest multiple rate carrier rate cards (Parent Rate cards) in either NPA-NXX or single cost (column) and output NPA-NXX or single-cost.
Based on how you wish to calculate these it can take the min,max or average values.

### Different Length Prefixes
The ConnexCS rate card engine can deal with abritary length prefixes and understand strict rules that are required when merging these together.

#### Why do I have alot of long prefixes
In order to ensure accuracy it may be required to **normalize** rate cards when combining them, this process makes all the cards comparible and can cause additional prefixes to be added. These changes are safe and are to increase granularity, they will not introduce errors. After the compilation process has taken place additional scripts to run to make the rate card smaller again, however the primary goal of the engine is accuracy.

### Combining
#### Between Cards
If you have multiple carrier cards and you wish to compile them into a single card you will need to pay attention to the **Rate Compact** variable. This will be the strategy that it will use to output a cost per destination. You could use Min if you are dealing with cost sensitive routing, or Max if you are looking at quality driven prices.

_Note: If you use Min there as default your calls will be routed to the cheapest provider first, but if that provider does not take the call, it will failover to a more expensive provider. There is the possibility that this provide may be higher than your profit margins. You can enable Profit Assurance, but be prepared, Profit Assurance cant protect against different billing pulses OR connection fee's_

#### Different Card Types
If you wish to transform an NPA-NXX price into a single cost per code, you will need to **collapse** your rate card. This takes similar settings to **Rate Compact** however this rule is used when picking out a single cost per prefix per provider. It is joined with other providers AFTER this process has taken place.

### Adding Profits
Once you have combined your rate cards you can add your margins.

The Margins are defined as Regular Expressions or standard prefixes if numeric only. A rule will match all child rules. e.g if you add `49` it will apply the rules to `491`, `492`, `4912345` or whatever rules were generated by the previous process.

There are 3 strategies used here:
* **Absolute** - This used the value that you enter and disregards any previously set values.
* **Relative** - This adds the value that you enter to the rules generated by the previous process.
* **Percent** - This calculates your margin as a percentage.

_Using Absolute & Relative can be very useful, especially when dealing with large cards as if your providers prices change, only 1 click is needed to regenerate the customer rate cards._

### Why should I use this?
#### Example 1

You may wish to provide UK Landline to your customers and decide to add `441` in your rate deck. Your carrier may charge more to deliver calls to Gurnsey so they would have a higher cost for `441481`. If you were to build your own card you would not know about this.

A possible consequence is that your carrier will charge you more and you may loose money. Profit Assurance can protect you against this in some senarios, but not if your carrier bills on 60/60 and you are selling at 1/1 or if you carrier has connection fee's. Also your customer may be expecting to connect calls to prefixes that you didnt include if you rely purely on profit assurance.

#### Example 2

If you sell NPA-NXX, but you also have a few flat rates (and cherry picking is allowed) with just a 1 prefix, you can combine multiple cards together to generate the most competitive pricing. The place your margins at 20%, once a carrier issues you a new rate card, you can simple click regenerate and the system will deal with all 200K prefixes on each and generate new pricing for you.

### Example 3

<table class="table"><thead><tr><th>Prefix</th>
<th>Destination</th>
<th>Cost</th>
</tr></thead><tbody><tr><td><strong>Provider Rate Card A</strong></td>
<td> </td>
<td> </td>
</tr><tr><td>441</td>
<td>UK Landline</td>
<td>0.01</td>
</tr><tr><td>442</td>
<td>UK Landline</td>
<td>0.01</td>
</tr><tr><td><strong>Provider Rate Card B</strong></td>
<td> </td>
<td> </td>
</tr><tr><td>441</td>
<td>UK Landline</td>
<td>0.0075</td>
</tr><tr><td>442</td>
<td>UK Landline</td>
<td>0.0075</td>
</tr><tr><td><strong>Provider Rate Card C</strong></td>
<td> </td>
<td> </td>
</tr><tr><td>441</td>
<td>UK Landline</td>
<td>0.02</td>
</tr><tr><td>442</td>
<td>UK Landline</td>
<td>0.02</td>
</tr></tbody></table><h2><strong>Outputs</strong></h2>
<p>If we merged all 3 of the above cards, each with a different Rate Compact, we would end up with the following different rate cards.</p>
<h2><strong>Minimum</strong></h2>
<table class="table"><thead><tr><th>Prefix</th>
<th>Destination</th>
<th>Cost</th>
</tr></thead><tbody><tr><td>441</td>
<td>UK Landline</td>
<td>0.0075</td>
</tr><tr><td>442</td>
<td>UK Landline</td>
<td>0.0075</td>
</tr></tbody></table><h2><strong>Maximum</strong></h2>
<table class="table"><thead><tr><th>Prefix</th>
<th>Destination</th>
<th>Cost</th>
</tr></thead><tbody><tr><td>441</td>
<td>UK Landline</td>
<td>0.02</td>
</tr><tr><td>442</td>
<td>UK Landline</td>
<td>0.02</td>
</tr></tbody></table><h2><strong>Average</strong></h2>
<table class="table"><thead><tr><th>Prefix</th>
<th>Destination</th>
<th>Cost</th>
</tr></thead><tbody><tr><td>441</td>
<td>UK Landline</td>
<td>0.0125</td>
</tr><tr><td>442</td>
<td>UK Landline</td>
<td>0.0125</td></tr></tbody></table>
